<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../img/favicon.ico">
        <title>2. Queries - DOC.TON.DEV</title>
        <link href="../../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../../..">DOC.TON.DEV</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../../..">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">1. Compilers <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../../1. Compilers/ABI Specification/">ABI Specification</a>
</li>
                                    
<li >
    <a href="../../../../1. Compilers/Intro/">Intro</a>
</li>
                                    
<li >
    <a href="../../../../1. Compilers/Linker CLI/">Linker CLI</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">LLVM</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../1. Compilers/LLVM/1. Compiler Highlights/">1. Compiler Highlights</a>
</li>
            
<li >
    <a href="../../../../1. Compilers/LLVM/2. C Support Status/">Language Features</a>
</li>
            
<li >
    <a href="../../../../1. Compilers/LLVM/3. C to TVM Library/">3. C to TVM Library</a>
</li>
            
<li >
    <a href="../../../../1. Compilers/LLVM/4. Debugging Options/">4. Debugging Options</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Solidity</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../1. Compilers/Solidity/1. Support status/">Fully Supported/Pending Release</a>
</li>
            
<li >
    <a href="../../../../1. Compilers/Solidity/2. Reference Guide/">2. Reference Guide</a>
</li>
            
<li >
    <a href="../../../../1. Compilers/Solidity/3. Usage/">3. Usage</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">2. SDK <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../1. Installation/">1. Installation</a>
</li>
                                    
<li >
    <a href="../../../2. Overview/">2. Overview</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Auxiliaries</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Auxiliaries/Getting Logs/">Getting Logs</a>
</li>
            
<li >
    <a href="../../../Auxiliaries/Installing Ubuntu VM/">Installing Ubuntu VM</a>
</li>
            
<li >
    <a href="../../../Auxiliaries/TON SDK CLI/">TON SDK CLI</a>
</li>
            
<li >
    <a href="../../../Auxiliaries/Troubleshooting/">Troubleshooting</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Client Libraries</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Library Modules</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../1. Overview/">1. Overview</a>
</li>
            
<li class="active">
    <a href="./">2. Queries</a>
</li>
            
<li >
    <a href="../3. Crypto/">3. Crypto</a>
</li>
            
<li >
    <a href="../4. Contracts/">4. Contracts</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Using Libraries</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../Using Libraries/2. Node.js/">2. Node.js</a>
</li>
            
<li >
    <a href="../../Using Libraries/3. Rust/">3. Rust</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Local node</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Local node/Local Node/">Local Node</a>
</li>
            
<li >
    <a href="../../../Local node/Node SE Giver/">Node SE Giver</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TON Labs Testnet</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../TON Labs Testnet/Testnet Giver/">Testnet Giver</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">3. TON Blockchain <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../../3. TON Blockchain/Gal Calculation Basics/">Gas Calculation Basics</a>
</li>
                                    
<li >
    <a href="../../../../3. TON Blockchain/Replay Attack Protection/">Replay Attack Protection</a>
</li>
                                    
<li >
    <a href="../../../../3. TON Blockchain/Storage Fee Calculation/">Welcome to MkDocs</a>
</li>
                                    
<li >
    <a href="../../../../3. TON Blockchain/TVM Error Codes/">TVM Error Codes</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">4. FAQ <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../../4. FAQ/">TON Dev Documentation</a>
</li>
                                    
<li >
    <a href="../../../../4. FAQ/SDK and Integration/">SDK and Integration</a>
</li>
                                    
<li >
    <a href="../../../../4. FAQ/Smart Contracts/">Smart Contracts</a>
</li>
                                    
<li >
    <a href="../../../../4. FAQ/Solidity Compiler/">Solidity Compiler</a>
</li>
                                    
<li >
    <a href="../../../../4. FAQ/TON and TVM/">TON and TVM</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">5. Misc <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../../5. Misc/Glossary/">The Moonspeak</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../1. Overview/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../3. Crypto/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#making-queries">Making queries</a></li>
        <li class="main "><a href="#subscriptions">Subscriptions</a></li>
        <li class="main "><a href="#filtration-and-sorting">Filtration and sorting</a></li>
            <li><a href="#scalar-filters">Scalar filters</a></li>
            <li><a href="#array-filters">Array filters</a></li>
            <li><a href="#structure-filters">Structure filters</a></li>
            <li><a href="#joins">Joins</a></li>
            <li><a href="#sorting-and-limiting">Sorting and limiting</a></li>
        <li class="main "><a href="#special-fields">Special fields</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>Use the SDK to make queries to blockchain objects. A <em>live blockchain snapshot</em> is accessible through an ArangoDB instance in the local node.</p>
<p>To query it, GraphQL protocol with subscription options is implemented (get the schema at <a href="http://127.0.0.1/graphql">http://127.0.0.1/graphql</a>). All data in the database are divided into following collections:</p>
<ul>
<li><em>accounts</em>: blockchain account data;</li>
<li><em>transactions</em>: transactions related to accounts;</li>
<li><em>messages:</em> input and output messages related to transactions;</li>
<li><em>blocks:</em> blockchain blocks.</li>
</ul>
<p>The structure of each collection item matches that on the TON blochchain. So, for additional details on specific fields refer to official TON documentation.</p>
<p>The <code>queries</code> module of the Client library defines four objects to access each collection: <code>accounts</code>, <code>transactions</code>, <code>messages</code> and <code>blocks</code>. Each object has a set of query methods:</p>
<ul>
<li><code>query</code>: filters collection items according to the requested condition. The available filtration functionality covers a wide range of tasks. If none of the collection items matches the request, an empty set is returned.</li>
<li><code>waitFor</code>: same as above, but this method never returns until the requested item appears (i.e. it actually waits).</li>
<li><code>subscribe</code>: starts monitoring the relevant blockchain for items matching the requests. The subscription monitors all insert and update operations.</li>
</ul>
<h2 id="making-queries">Making queries</h2>
<p>To perform a query over the relevant blockchain, choose a collection and then specify a filter, result projection, sorting order and the maximum number of items in the results list.</p>
<pre><code class="javascript">const transactions = await client.queries.transactions.query({
    now: { eq: 1567601735 }
}, 'id now status');
</code></pre>

<p>The example above demonstrates a query to the <code>transactions</code> collection with the following parameters:</p>
<ul>
<li><code>filter</code>: a JSON object matching the internal collection structure. It supports additional conditions for particular fields. In the example above, the <code>now</code> field of a transaction must be equal to 1567601735.</li>
<li><code>result</code>: is a result projection that deter structural subset used for returning items. In the example above the request is limited to three fields: <code>id</code>, <code>now</code> and <code>status</code>. Note that results have to follow GraphQL rules.</li>
</ul>
<p>Given that the <code>now</code> field is unique in the example, the <code>transactions</code> array is either empty or contains one item.</p>
<p>The <code>waitFor</code> method can be used to obtain items that are not yet written to the blockchain but are expected to appear.</p>
<pre><code class="javascript">const transactions = await client.queries.transactions.waitFor({
    now: { eq: 1567601735 }
}, 'id now status');
</code></pre>

<p>The signature of the <code>waitFor</code> is exactly the same as for the <code>query</code>. The only difference is behavior: if there is no transaction with the specified <code>now</code> in the requested blockchain, this method waits indefinitely until the transaction appears in the blockchain.</p>
<h2 id="subscriptions">Subscriptions</h2>
<p>Some applications monitor blockchain for a specific data set or for potential updates. The subscribe method (included in collection object) handles these scenarios:</p>
<pre><code class="javascript">const subscription = client.queries.blocks.subscribe({}, 'id', (e, doc) =&gt; {
    console.log('On block have created: ', doc);
});

setTimeout(() =&gt; {
    subscription.unsubscribe();
    resolve();
}, 10*60*1000);
</code></pre>

<p>In this example, we start a subscription and react whenever a block is inserted or updated in the relevant blockchain.</p>
<p>The <code>filter</code> and <code>result</code> parameters are the same as in the <code>query</code> method. The <code>filter</code> parameter narrows the action down to a subset of monitored items. In this case, the filter is empty: all items are included into monitoring.</p>
<p>The last parameter is an event handler. This event is triggered every time the monitored block is inserted or updated in the relevant blockchain.</p>
<p>The return value of the <code>subscribe</code> method is a subscription object with one available method:<code>unsubscribe</code>. The subscription remains active until it is called. In the example above the subscription is cancelled within 10 min.</p>
<h2 id="filtration-and-sorting">Filtration and sorting</h2>
<p>Filters applied to querying functions are data structures matching collection items with several extra features:</p>
<ul>
<li>The value for scalar fields (e.g. strings, numbers etc.) is a structure with the scalar filter.</li>
<li>The value for array fields is a structure with an array filter.</li>
<li>The value for nested structures is a filter for nested structure.</li>
</ul>
<h3 id="scalar-filters">Scalar filters</h3>
<p>Scalar filter is a structure with one or more predefined fields. Each field defines a specific scalar operation and a reference value:</p>
<ul>
<li><code>eq</code>: item value must be equal to the specified value;</li>
<li><code>ne</code> : item value must not be equal to the specified value;</li>
<li><code>gt</code>: item value must be greater than the specified value;</li>
<li><code>lt</code>: item value must be less than specified value;</li>
<li><code>ge</code>: item value must be greater than or equal to the specified value;</li>
<li><code>le</code>: item value must be less than or equal to the specified value;</li>
<li><code>in</code>: item value must be contained in the specified array of values;</li>
<li><code>notIn</code>: item value must not be contained within the specified array of values.</li>
</ul>
<p>Filter example:</p>
<pre><code>{
    id: { eq: 'e19948d53c4fc8d405fbb8bde4af83039f37ce6bc9d0fc07bbd47a1cf59a8465'},
    status: { in: [&quot;Preliminary&quot;, &quot;Proposed&quot;, &quot;Finalized&quot;] }
}
</code></pre>

<blockquote>
<p>Note that when a scalar filter for a field contains multiple operators, the<code>AND</code> logical operator is used to combine all the conditions:</p>
</blockquote>
<pre><code class="javascript">{
    now: { gt: 1563449, lt: 2063449 }
} 
</code></pre>

<p>The logic from the above snippet can be expressed in the following way:</p>
<pre><code class="javascript">(transaction.now &gt; 1563449) &amp;&amp; (transaction.now &lt; 2063449)
</code></pre>

<h3 id="array-filters">Array filters</h3>
<p>Array filters are used for array (list) fields. Each has to contain at least one of the predefined operators:</p>
<ul>
<li><code>any</code> : used when at least one array item matches the nested filter;</li>
<li><code>all</code>: used when all items matches the nested filter.</li>
</ul>
<p>The <code>any</code> or <code>all</code> must contain a nested filter for an array item.</p>
<p>Array operators are mutually exclusive and can not be combined. For empty arrays, the array filter is assumed to be false.</p>
<h3 id="structure-filters">Structure filters</h3>
<p>If an item is a structure, then a filter has to contain fields named as fields of this item. Each nested filter field contains a condition for the appropriate field of an item. The <code>AND</code> operator is used to combine conditions for several fields.</p>
<h3 id="joins">Joins</h3>
<p>The NoSQL database contains additional fields that work as cross-references for related collections. For example, the <em>transactions</em> collection has the <code>in_message</code> field that stores the relevant message item. The message item exists in <em>messages</em> collection and has the <code>id</code> value equal to the <code>in_msg</code> value in <em>transactions</em>.</p>
<p>Joined items are represented as nested structures in a filter and in the result projection.</p>
<h3 id="sorting-and-limiting">Sorting and limiting</h3>
<p>By default, retrieval order for several items is not defined. To specify it, use the <code>orderBy</code> parameter of <code>query</code> method.</p>
<p>The sort order is represented by an array or sort descriptors. These structures contain two fields: <code>path</code> and <code>direction</code>:</p>
<ul>
<li><code>path</code> specifies a path from a root item of the collection to the field that determines the order of return items. The path includes field names separated by dot.</li>
<li><code>direction</code> specifies the sorting order: <code>ASC</code> or <code>DESC</code> (ascending and descending).</li>
</ul>
<p>You can specify more than one field to define an order. If two items have equal values for the first sort descriptor, then second descriptor is used for comparison, etc. If values of sorting fields are the same for several items, then the order of these items is not defined.</p>
<p>The <code>limit</code> parameter determines the maximum number of items returned. This parameter has a default value of 50 and can not exceed it. If specified limit exceeds 50, 50 is used.</p>
<h2 id="special-fields">Special fields</h2>
<p>Each items in each collection has a unique key stored in the <code>id</code> field. This ID is the same as the item blockchain identifier.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../../../js/base.js" defer></script>
        <script src="../../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
