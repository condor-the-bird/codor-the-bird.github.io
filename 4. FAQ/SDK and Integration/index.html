<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>SDK and Integration - DOC.TON.DEV</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">DOC.TON.DEV</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../..">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">1. Compilers <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../1. Compilers/ABI Specification/">ABI Specification</a>
</li>
                                    
<li >
    <a href="../../1. Compilers/Intro/">Intro</a>
</li>
                                    
<li >
    <a href="../../1. Compilers/Linker CLI/">Linker CLI</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">LLVM</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../1. Compilers/LLVM/1. Compiler Highlights/">1. Compiler Highlights</a>
</li>
            
<li >
    <a href="../../1. Compilers/LLVM/2. C Support Status/">Language Features</a>
</li>
            
<li >
    <a href="../../1. Compilers/LLVM/3. C to TVM Library/">3. C to TVM Library</a>
</li>
            
<li >
    <a href="../../1. Compilers/LLVM/4. Debugging Options/">4. Debugging Options</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Solidity</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../1. Compilers/Solidity/1. Support status/">Solidity Support Status</a>
</li>
            
<li >
    <a href="../../1. Compilers/Solidity/2. Reference Guide/">2. Reference Guide</a>
</li>
            
<li >
    <a href="../../1. Compilers/Solidity/3. Usage/">3. Usage</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">2. SDK <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../2. SDK/1. Installation/">1. Installation</a>
</li>
                                    
<li >
    <a href="../../2. SDK/2. Overview/">2. Overview</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Auxiliaries</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../2. SDK/Auxiliaries/Getting Logs/">Getting Logs</a>
</li>
            
<li >
    <a href="../../2. SDK/Auxiliaries/Installing Ubuntu VM/">Installing Ubuntu VM</a>
</li>
            
<li >
    <a href="../../2. SDK/Auxiliaries/TON SDK CLI/">TON SDK CLI</a>
</li>
            
<li >
    <a href="../../2. SDK/Auxiliaries/Troubleshooting/">Troubleshooting</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Client Libraries</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Library Modules</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../2. SDK/Client Libraries/Library Modules/1. Overview/">1. Overview</a>
</li>
            
<li >
    <a href="../../2. SDK/Client Libraries/Library Modules/2. Queries/">2. Queries</a>
</li>
            
<li >
    <a href="../../2. SDK/Client Libraries/Library Modules/3. Crypto/">3. Crypto</a>
</li>
            
<li >
    <a href="../../2. SDK/Client Libraries/Library Modules/4. Contracts/">4. Contracts</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Using Libraries</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../2. SDK/Client Libraries/Using Libraries/2. Node.js/">2. Node.js</a>
</li>
            
<li >
    <a href="../../2. SDK/Client Libraries/Using Libraries/3. Rust/">3. Rust</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Local node</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../2. SDK/Local node/Local Node/">Local Node</a>
</li>
            
<li >
    <a href="../../2. SDK/Local node/Node SE Giver/">Node SE Giver</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TON Labs Testnet</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../2. SDK/TON Labs Testnet/Testnet Giver/">Testnet Giver</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">3. TON Blockchain <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../3. TON Blockchain/Gal Calculation Basics/">Gas Calculation Basics</a>
</li>
                                    
<li >
    <a href="../../3. TON Blockchain/Replay Attack Protection/">Replay Attack Protection</a>
</li>
                                    
<li >
    <a href="../../3. TON Blockchain/Storage Fee Calculation/">Storage Fee Calculation</a>
</li>
                                    
<li >
    <a href="../../3. TON Blockchain/TVM Error Codes/">TVM Error Codes</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">4. FAQ <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../">TON Dev Documentation</a>
</li>
                                    
<li class="active">
    <a href="./">SDK and Integration</a>
</li>
                                    
<li >
    <a href="../Smart Contracts/">Smart Contracts</a>
</li>
                                    
<li >
    <a href="../Solidity Compiler/">Solidity Compiler</a>
</li>
                                    
<li >
    <a href="../TON and TVM/">TON and TVM</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">5. Misc <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../5. Misc/Glossary/">The Moonspeak</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../Smart Contracts/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#sdk-and-integration">SDK and Integration</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="sdk-and-integration">SDK and Integration</h1>
<p><strong>Q</strong>: Would you be able to point me to where BOC messages are created or signed inside the JavaScript or Rust SDK? In the JS SDK, I just see that all calls end up hitting <code>this.requestLibrary</code> with some library specified, and that looks like it ends up calling a <code>TONClientLibrary</code> module, but it's not clear where these libraries actually exist (they seem to be on the node itself).</p>
<p><strong>A</strong>: BOC messages are created and signed inside the Rust SDK library. The library is located at the client side. For the Node.js SDK client, the native Node.js addon is used. For React Native, there is a native library for target platform where the client application is running. For the Web client, there is the Web Assembly module downloaded and executed at the client device. The Rust SDK library contains core SDK functions used on all platforms.</p>
<p>The SDK will be available as Open Source and more platform and language rappers are to be developed. We are open to customer and community suggestions and contributions to the repository, once it is open.</p>
<hr />
<p><strong>Q</strong>: Don’t see any code in the SDK's that is actually generating keys locally or constructing .boc messages. It seems they are just calling your node to do that for them, so it seems like more of a client to the node. Please correct me if that’s not right.</p>
<p><strong>A</strong>: See the previous answer. Keys are generated in the Rust core library running on a client device. The message BOC construction code is also located there. The SDK's interaction with the node is limited to sending external blockchain messages calling contracts and querying results from the GraphQL server. All crypto operations are performed locally.</p>
<hr />
<p><strong>Q</strong>: Is there an API call to the full node that returns a given account’s balance along with the block height at which that balance was calculated, in a single API call? Note: This IS NOT the same thing as historical balance lookup. (Example: GET /balance/account1 -&gt; {balance:10, height: 123902}) The current account state provided by the lite-client does not include this information. Can we be given this information if it is not available today?</p>
<p><strong>A</strong>: It is possible to get this information by the series of graphQL queries:</p>
<ul>
<li>query an account by its ID (address) and remember <code>last_trans_lt</code> (last transaction logical time)</li>
</ul>
<pre><code class="SQL"> query {
   accounts(filter: {id: {eq: &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;}}) {
     id,
     storage {last_trans_lt}
   }
 }
</code></pre>

<ul>
<li>result:</li>
</ul>
<pre><code class="html">{
   &quot;data&quot;: {
     &quot;accounts&quot;: [
       {
         &quot;id&quot;: &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;,
         &quot;storage&quot;: {
           &quot;last_trans_lt&quot;: 4
         }
       }
     ]
   }
 }
</code></pre>

<ul>
<li>query the transaction with your account ID and the logical time; remember the corresponding <code>block_id</code></li>
</ul>
<pre><code class="sql">query {
   transactions(filter: {
     account_addr: {eq: &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;}
     lt: {eq: 4}
   }) {
     id,
     block_id
   }
 }
</code></pre>

<ul>
<li>result:</li>
</ul>
<pre><code class="HTML">{
   &quot;data&quot;: {
     &quot;transactions&quot;: [
       {
         &quot;id&quot;: &quot;3badb9e5707db8e61e0e335e02eacb6df2a118512791b620c73a71d826e840c3&quot;,
         &quot;block_id&quot;: &quot;4a8537f7499e122fc539b6250cd70168e80a129dcd684de6d0928d86105cf430&quot;
       }
     ]
   }
 }
</code></pre>

<ul>
<li>query a block by an ID with the required data:</li>
</ul>
<pre><code class="sql">query {
   blocks(filter: {
     id: {eq: &quot;4a8537f7499e122fc539b6250cd70168e80a129dcd684de6d0928d86105cf430&quot;}
   }) {
     id,
        info {
       seq_no
     }
   }
 }
</code></pre>

<ul>
<li>result:</li>
</ul>
<pre><code class="html">{
   &quot;data&quot;: {
     &quot;blocks&quot;: [
       {
         &quot;id&quot;: &quot;4a8537f7499e122fc539b6250cd70168e80a129dcd684de6d0928d86105cf430&quot;,
         &quot;info&quot;: {
           &quot;seq_no&quot;: 1
         }
       }
     ]
   }
 }
</code></pre>

<hr />
<p><strong>Q</strong>: Does your node currently (or will you) provide an API to submit pre-signed messages (e.g. a pre-signed bag-of-cells message)? Can we have this endpoint (not a CLI interface) if it does not exist today?</p>
<p><strong>A</strong>: To send pre-generated messages, use the <code>processMessage</code> function of the SDK JS client. Also, there will be a function to construct unsigned messages. You will be able to sign generated message yourself and then to send it using the SDK. </p>
<p>For example you can generate message to call the contract by SDK function. That function returns a serialized message and its hash to be signed. You sign it using your own implementation of the signature algorithm (or using some hardware security module). Then you call another SDK function that adds your signature to the message generated at first step. Finally, the resulting signed message can be sent by <code>processMessage</code> function.</p>
<hr />
<p><strong>Q</strong>: How does one derive the message (or transaction) hash from a signed bag-of-cells message to a contract? Can you provide details on how we can compute this on our own? (Ideally we can compute this so we can look it up after submitting to the network.)</p>
<p><strong>A</strong>: The SDK returns hash of the generated message as a message ID. We will provide a function which will return hash for a specific message in the next few weeks. To calculate hash manually, deserialize the bag of cells into a tree of cells and calculate the representation hash of the root cell as described in paragraph <code>3.1.5</code> of the original TVM specification. It's quite an effort, though.</p>
<hr />
<p><strong>Q</strong>: It seems that messages are not replay protected on their own. Is this the case? Is there any default replay protection provided by the network or must every contract implement their own sequence number or similar method to replay protection?</p>
<p><strong>A</strong>: There is no default replay attack protection in TON. A contract developer is supposed to implement it manually. There are only "best practices" by TON developers <a href="https://test.ton.org/smc-guidelines.txt">here</a>. TON Labs compilers will have a default inline implementation of replay protection.</p>
<hr />
<p><strong>Q</strong>: Can you provide more explicit details or provide an example of how an account’s address is derived from the compiled contract and initial state and specifically how that hash is computed and over what components? Source code is also helpful here if you can provide it.</p>
<p><strong>A</strong>: A blockchain account contains the <code>State Init</code> field. It stores the contract code and persisted data. <code>State init</code> is also tree of cells. At contract deployment this field is transferred alongside the deploying message (so called constructor message) and is set as the contract initial state. The representation hash (see paragraph <strong>3.1.5</strong> of the TVM specification) of the contract initial state is the account address. The node checks that the state init hash of the deployment message is equal to the destination address. The SDK will have a function for computing account address by its initial state. The SDK source code will be available soon.</p>
<hr />
<p><strong>Q</strong>: Is (or will be) the solidity-to-tvm and tvm-linker source code available to users? If not, can agreements be signed to make it available to partners?</p>
<p><strong>A</strong>: Yes, both Sol2Tvm compiler and TVM-Linker will be available as open source.</p>
<hr />
<p><strong>Q</strong>: With a Solidity contract, how does one properly specify an address parameter? In solidity, addresses are uint256 but this can only capture the address portion and not the workchain_id. How would one specify the full address parameter correctly here? (e.g. “0:D702CC0414858D83A5538A3C1C86231872F006453AF7C825A59F9DD12D636AF” is invalid in solidity for an address param)</p>
<p><strong>A</strong>: Now we only use the <code>address</code> field of <em>MsgAddressInt</em> structure as Solidity <code>address</code> type. We assume that worckchain_id is 0. But in future the <code>address</code> type will represent the whole <em>MsgAddressInt</em> structure. Now workchain_id can be defined separately as int8.</p>
<hr />
<p><strong>Q</strong>: When deploying a contract init message that was created using a solidity contract, the Sol2TVM compiler and tvm_linker, I’m seeing the init succeed initially but then also get replayed dozens of times after. How does one replay protect a contract init message for a solidity-compiled contract? (example message that was replayed after the initialization was already successful previously: <https://test.ton.org/testnet/transaction?account=EQDXAswEFIWNg6VTijwchiMYcvAGRTr3yCWln53RLWNq8CvQ<=195287000001&hash=7F09EC8EEBBAF510D7873CD3DEC494B2DD28A790A7A46E83D0A183F3E672B509>)</p>
<p><strong>A</strong>: The sample message at <https://test.ton.org/testnet/transaction?account=EQDXAswEFIWNg6VTijwchiMYcvAGRTr3yCWln53RLWNq8CvQ<=195287000001&hash=7F09EC8EEBBAF510D7873CD3DEC494B2DD28A790A7A46E83D0A183F3E672B509> has no init (it is <code>init:nothing</code>), and a transaction with this message is aborted. But in general, the StateInit data attached to a message is used by the node only once: when a contract is in the Uninit state. Replays of such message can succeed, but the contract code will not be changed. An Init msg created with sol2tvm compiler and tvm_linker contains an encoded constructor call. Now you can call constructor multiple times, but in future releases it will be changed.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
